<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>双六ゲーム</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <!-- ホーム画面 -->
  <div id="homeScreen">
    <h1 class="game-title">
      飲んで！進んで！ <span class="emoji-beer">🍻</span><br>
      ゴールまで！！ <span class="emoji-dice">🎲</span>
    </h1>
    <label for="playerCount">プレイヤー人数（2〜6人）:</label>
    <select id="playerCount">
      <option value="" disabled selected>選択してください</option>
      <option value="2">2人</option>
      <option value="3">3人</option>
      <option value="4">4人</option>
      <option value="5">5人</option>
      <option value="6">6人</option>
    </select>

    <!-- プレイヤー名入力欄（動的に生成） -->
    <div id="playerNameInput" style="display:none;"></div>

    <!-- ゲーム開始ボタン -->
    <button id="startGame">ゲーム開始</button>
  </div>

  <!-- プレイヤーの順番を表示 -->
  <div id="playerOrderDisplay" style="display: none; text-align: center;">
    <p id="playerOrderText"></p>
    <button id="confirmOrderButton">OK!</button>
  </div>

  <!-- 設定ボタン -->
  <button id="settingsBtn" class="settings-button hidden">
    ⚙️
  </button>
  <!-- 設定パネル -->
  <div id="settingsPanel" class="hidden">
    <button id="closeSettingsBtn" class="panel-close">×</button>
    <button id="addPlayerBtn">＋ プレイヤー追加</button><br>
    <button id="removePlayerBtn">－ プレイヤー削除</button>
  </div>

  <!-- お椀エリア -->
  <div id="bowlArea" class="hidden">
    <canvas id="threeCanvas"></canvas>
    <!-- 出目の表示 -->
    <div id="dice-result">出目：？</div>
  </div>

  <!-- イベントカード表示エリア -->
  <div id="eventCard" class="hidden">
    <div class="card-inner">
      <div class="card-front"></div>
      <div class="card-back"></div>
    </div>
  </div>

  <!-- 幕の表示 -->
  <div id="curtain" class="curtain"></div>

  <!-- プレイ画面（最初は非表示） -->
  <div id="gameScreen" class="hidden">
    <!-- プレイヤー追加モーダル -->
    <div id="addPlayerModal" class="modal hidden">
      <div class="modal-content">
        <h2>プレイヤー追加</h2>
        <div id="addPlayerForm"></div>
        <button id="confirmAddPlayer">決定</button>
      </div>
    </div>

    <div id="gamePlayerList"></div>

    <!-- プレイヤー交代ボタン -->
    <button id="nextPlayerButton">次のプレイヤーに交代</button>
    <p id="turnInfo"></p>

    <!-- マスの配置 -->
    <div id="board">
      <svg id="pathLayer"
        style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"
        viewBox="0 0 800 600"
        preserveAspectRatio="none">
      </svg>
      <div class="cell start">
        <span class="cellText">スタート</span>
      </div>
    </div>
    

    <!-- ホーム画面へ遷移 -->
    <button id="backToHomeButton" class="hidden">ホーム画面へ戻る</button>
  </div>

<!-- JavaScriptを読み込む -->
<script src="./src/libs/ammo/ammo.wasm.js"></script>
<script>
  Ammo().then(function(AmmoLib) {
    window.Ammo = AmmoLib;

    import('./src/libs/three/build/three.module.js').then(THREE => {
      window.THREE = THREE;

      // DOM がすでに読み込まれているか確認
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', async () => {
          const { startGameApp } = await import('./src/main.js?v=20251212'); // ver.(1/2か所目)
          startGameApp();
        });
      } else {
        // すでに読み込み済みなら即実行
        (async () => {
          const { startGameApp } = await import('./src/main.js?v=20251212'); // ver.(2/2か所目)
          startGameApp();
        })();
      }
    });
  });
</script>

</body>
</html>